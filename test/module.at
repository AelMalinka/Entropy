AT_BANNER([Module Test])
AT_SETUP([Module Run])
AT_CHECK_UNQUOTED([LD_LIBRARY_PATH=${BUILD} module-run], [], [[module.so:foo()
module.so:bar()
module.so:foo()
module.so:foo()
module.so:bar()
module.so:bar()
Module Error: dlopen error
]])
AT_CLEANUP

AT_SETUP([Module Import])
AT_CHECK_UNQUOTED([LD_LIBRARY_PATH=${BUILD} module-import], [], [[Module::run()
Module::operator[]: a
Module::operator[]: 0
Module::operator = 0
]])
AT_CLEANUP

AT_SETUP([Module Import Twice])
AT_CHECK_UNQUOTED([LD_LIBRARY_PATH=${BUILD} module-import-twice], [], [[Module::run()
Module::operator[]: a
Module::operator[]: 0
Module::operator = 0
Module::run()
Module::run()
Module::operator[]: a
Module::operator[]: a
Module::operator[]: 0
Module::operator[]: 0
Module::operator = 0
Module::operator = 0
]])
AT_CLEANUP

AT_SETUP([Module Import Twice Copy])
AT_CHECK_UNQUOTED([LD_LIBRARY_PATH=${BUILD} module-import-copy], [], [[Module::run()
Module::operator[]: a
Module::operator[]: 0
Module::operator = 0
Module::run()
Module::run()
Module::operator[]: a
Module::operator[]: a
Module::operator[]: 0
Module::operator[]: 0
Module::operator = 0
Module::operator = 0
]])
AT_CLEANUP
